const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/Login-C4l3DZZn.js","js/vendor-B0DAOtER.js","js/useFormValidation-BtYJ3Z50.js","js/utils-ei4kQ0Q2.js","js/charts-BZyKnHge.js","css/Login-tn0RQdqM.css","js/Register-_ueccQLj.js","js/Incidents-D0X6Y2Id.js","js/Modal-Bzr7RJEW.js","css/Modal-CEut5xSb.css","css/Incidents-DCtuA4i2.css","js/Alerts-BxjIOTcB.js","css/Alerts-BVpOiNpd.css"])))=>i.map(i=>d[i]);
import{b as e,r as t,c as a,d as s,e as n,f as r,g as l,u as o,j as i,R as c,k as u,l as d,m as v,p as m,q as h,x as p,y as f,z as g,w as _,o as b,A as y,B as k,C as A,D as I}from"./vendor-B0DAOtER.js";import{a as w}from"./utils-ei4kQ0Q2.js";import{C as S,p as E,a as L,b as T,A as P,c as R,L as j,D}from"./charts-BZyKnHge.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O=w.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}});O.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),O.interceptors.response.use(e=>e,e=>Promise.reject(e));const $={getIncidents:()=>O.get("/incidents").then(e=>e.data),getIncident:e=>O.get(`/incidents/${e}`).then(e=>e.data),acknowledgeIncident:(e,t)=>O.put(`/incidents/${e}/acknowledge`,t).then(()=>{}),resolveIncident:e=>O.put(`/incidents/${e}/resolve`).then(()=>{})},q={getAlerts:()=>O.get("/alerts").then(e=>e.data)},C=()=>O.get("/metrics").then(e=>e.data),M=e=>O.post("/auth/login",e).then(e=>e.data),N=e=>O.post("/auth/register",e).then(e=>e.data),x=e=>O.post("/auth/refresh",{refresh_token:e}).then(e=>e.data),V=e("auth",()=>{const e=t(null),s=t(null),n=t(null),r=t(!1),l=t(null),o=a(()=>!!s.value&&!!e.value),i=a(()=>{var t;return(null==(t=e.value)?void 0:t.roles)||[]}),c=a(()=>{const e=new Set;return i.value.forEach(t=>{t.permissions.forEach(t=>{e.add(t.name)})}),Array.from(e)}),u=e=>i.value.some(t=>t.name===e),d=e=>c.value.includes(e),v=()=>{e.value=null,s.value=null,n.value=null,l.value=null,localStorage.removeItem("auth_token"),localStorage.removeItem("auth_refresh_token"),localStorage.removeItem("auth_user")},m=t=>{e.value=t.user,s.value=t.token,n.value=t.refresh_token,localStorage.setItem("auth_token",t.token),localStorage.setItem("auth_refresh_token",t.refresh_token),localStorage.setItem("auth_user",JSON.stringify(t.user))},h=()=>{const t=localStorage.getItem("auth_token"),a=localStorage.getItem("auth_refresh_token"),r=localStorage.getItem("auth_user");if(t&&r){s.value=t,n.value=a;try{e.value=JSON.parse(r)}catch(l){v()}}};return h(),{user:e,token:s,refreshToken:n,isLoading:r,error:l,isAuthenticated:o,userRoles:i,userPermissions:c,hasRole:u,hasPermission:d,hasAnyRole:e=>e.some(e=>u(e)),hasAnyPermission:e=>e.some(e=>d(e)),login:async e=>{var t,a;r.value=!0,l.value=null;try{const t=await M(e);return m(t),t}catch(s){throw l.value=(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||"Login failed",s}finally{r.value=!1}},register:async e=>{var t,a;r.value=!0,l.value=null;try{const t=await N(e);return m(t),t}catch(s){throw l.value=(null==(a=null==(t=s.response)?void 0:t.data)?void 0:a.message)||"Registration failed",s}finally{r.value=!1}},refreshAuthToken:async()=>{if(!n.value)throw new Error("No refresh token available");try{const e=await x(n.value);return m(e),e}catch(e){throw v(),e}},logout:v,loadAuthFromStorage:h}}),z={class:"navbar"},B={class:"nav-container"},W={class:"nav-content"},F={key:0,class:"nav-menu"},J={class:"nav-item"},U={class:"nav-item"},K={class:"nav-item"},G={key:1,class:"nav-user"},H={class:"user-info"},Q=(e,t)=>{const a=e.__vccOpts||e;for(const[s,n]of t)a[s]=n;return a},X=Q(s({__name:"Navbar",setup(e){const t=d(),a=h(),s=V(),g=()=>{s.logout(),a.push("/login")};return(e,a)=>{var d,h;return p(),n("nav",z,[r("div",B,[a[3]||(a[3]=r("div",{class:"nav-logo"},[r("h1",null,"Incident Management System")],-1)),r("div",W,[o(s).isAuthenticated?(p(),n("ul",F,[r("li",J,[i(o(c),{to:"/",class:u(["nav-link",{active:"dashboard"===o(t).name}])},{default:v(()=>[...a[0]||(a[0]=[f(" Dashboard ",-1)])]),_:1},8,["class"])]),r("li",U,[i(o(c),{to:"/incidents",class:u(["nav-link",{active:"incidents"===o(t).name}])},{default:v(()=>[...a[1]||(a[1]=[f(" Incidents ",-1)])]),_:1},8,["class"])]),r("li",K,[i(o(c),{to:"/alerts",class:u(["nav-link",{active:"alerts"===o(t).name}])},{default:v(()=>[...a[2]||(a[2]=[f(" Alerts ",-1)])]),_:1},8,["class"])])])):l("",!0),o(s).isAuthenticated?(p(),n("div",G,[r("span",H," Welcome, "+m((null==(d=o(s).user)?void 0:d.full_name)||(null==(h=o(s).user)?void 0:h.username)),1),r("button",{onClick:g,class:"logout-btn"},"Logout")])):l("",!0)])])])}}}),[["__scopeId","data-v-af7c7334"]]),Y={id:"app"},Z=Q(s({__name:"App",setup:e=>(e,t)=>(p(),n("div",Y,[i(X),r("main",null,[i(o(g))])]))}),[["__scopeId","data-v-7c7d98c6"]]),ee={},te=function(e,t,a){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in ee)return;ee[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,a&&n.setAttribute("nonce",a),document.head.appendChild(n),t?new Promise((t,a)=>{n.addEventListener("load",t),n.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};function ae(e){return new Date(e).toLocaleString()}function se(e){if(!e||0===e)return"-";const t=e/1e9;if(t<60)return`${Math.round(t)}s`;if(t<3600){return`${Math.round(t/60)}m`}if(t<86400){return`${Math.round(t/3600)}h`}return`${Math.round(t/86400)}d`}function ne(e,t){const a=new Date(e);return se(1e6*((t?new Date(t):new Date).getTime()-a.getTime()))}const re={class:"chart-container"},le=Q(s({__name:"DoughnutChart",props:{data:{},title:{}},setup(e){S.register(E,L,T,P,R,j);const a=e,s=t({labels:[],datasets:[{data:[],backgroundColor:["#e74c3c","#f39c12","#27ae60","#3498db","#9b59b6","#1abc9c"],borderWidth:1,borderColor:"#fff"}]}),r=t({responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:a.title,font:{size:16}},legend:{position:"bottom",labels:{padding:15,usePointStyle:!0}},tooltip:{callbacks:{label:function(e){const t=e.label||"",a=e.parsed||0,s=e.dataset.data.reduce((e,t)=>e+t,0);return`${t}: ${a} (${s>0?(a/s*100).toFixed(1):"0.0"}%)`}}}},cutout:"50%"});function l(e){const t=Object.keys(e),a=Object.values(e);s.value={labels:t,datasets:[{...s.value.datasets[0],data:a}]}}return _(()=>a.data,e=>{l(e)},{immediate:!0}),b(()=>{l(a.data)}),(e,t)=>(p(),n("div",re,[i(o(D),{data:s.value,options:r.value,class:"chart"},null,8,["data","options"])]))}}),[["__scopeId","data-v-153d25c8"]]),oe={class:"dashboard"},ie={class:"dashboard-header"},ce={class:"refresh-btn"},ue=["disabled"],de={key:0,class:"error-message"},ve={key:1,class:"loading"},me={key:2,class:"metrics-grid"},he={class:"metric-card"},pe={class:"metric-value"},fe={class:"metric-card"},ge={class:"metric-value critical"},_e={class:"metric-card"},be={class:"metric-value"},ye={class:"metric-card"},ke={class:"metric-value"},Ae={key:3,class:"charts-section"},Ie={class:"charts-grid"},we={class:"card"},Se={class:"card"},Ee=Q(s({__name:"Dashboard",setup(e){const a=t(null),s=t(!0),c=t(null),u=async()=>{try{s.value=!0,c.value=null,a.value=await C()}catch(e){c.value="Error loading dashboard data"}finally{s.value=!1}},d=()=>{u()};return b(()=>{u()}),(e,t)=>(p(),n("div",oe,[r("div",ie,[t[0]||(t[0]=r("h2",null,"Dashboard",-1)),r("div",ce,[r("button",{onClick:d,class:"btn btn-primary",disabled:s.value},m(s.value?"Loading...":"Refresh"),9,ue)])]),c.value?(p(),n("div",de,m(c.value),1)):s.value?(p(),n("div",ve,"Loading dashboard...")):a.value?(p(),n("div",me,[r("div",he,[t[1]||(t[1]=r("div",{class:"metric-title"},"Total Incidents",-1)),r("div",pe,m(a.value.total_incidents||0),1)]),r("div",fe,[t[2]||(t[2]=r("div",{class:"metric-title"},"Open Incidents",-1)),r("div",ge,m(a.value.open_incidents||0),1)]),r("div",_e,[t[3]||(t[3]=r("div",{class:"metric-title"},"MTTA",-1)),r("div",be,m(o(se)(a.value.mtta)),1),t[4]||(t[4]=r("div",{class:"metric-subtitle"},"Mean Time To Acknowledge",-1))]),r("div",ye,[t[5]||(t[5]=r("div",{class:"metric-title"},"MTTR",-1)),r("div",ke,m(o(se)(a.value.mttr)),1),t[6]||(t[6]=r("div",{class:"metric-subtitle"},"Mean Time To Resolve",-1))])])):l("",!0),a.value&&!s.value?(p(),n("div",Ae,[r("div",Ie,[r("div",we,[i(le,{data:a.value.incidents_by_status||{},title:"Incidents by Status"},null,8,["data"])]),r("div",Se,[i(le,{data:a.value.incidents_by_severity||{},title:"Incidents by Severity"},null,8,["data"])])])])):l("",!0)]))}}),[["__scopeId","data-v-5f0cba37"]]),Le=y({history:k("/"),routes:[{path:"/login",name:"login",component:()=>te(()=>import("./Login-C4l3DZZn.js"),__vite__mapDeps([0,1,2,3,4,5])),meta:{requiresAuth:!1}},{path:"/register",name:"register",component:()=>te(()=>import("./Register-_ueccQLj.js"),__vite__mapDeps([6,1,2,3,4,5])),meta:{requiresAuth:!1}},{path:"/",name:"dashboard",component:Ee,meta:{requiresAuth:!0}},{path:"/incidents",name:"incidents",component:()=>te(()=>import("./Incidents-D0X6Y2Id.js"),__vite__mapDeps([7,1,8,9,3,4,10])),meta:{requiresAuth:!0}},{path:"/alerts",name:"alerts",component:()=>te(()=>import("./Alerts-BxjIOTcB.js"),__vite__mapDeps([11,8,1,9,3,4,12])),meta:{requiresAuth:!0}}]});Le.beforeEach((e,t,a)=>{const s=V();!1!==e.meta.requiresAuth&&!s.isAuthenticated?a("/login"):"/login"!==e.path&&"/register"!==e.path||!s.isAuthenticated?a():a("/")});const Te=A(Z);Te.use(I()),Te.use(Le),Te.mount("#app");export{Q as _,q as a,ne as c,ae as f,$ as i,V as u};
