import{d as E,r as v,o as M,c as n,a as e,b as r,e as S,t as a,F as D,f as $,w as L,i as f,g as u,n as y,u as _,h as p,j as o,k as T,_ as F}from"./index-DJdMDuAV.js";import{M as R}from"./Modal-DNJJ8fbt.js";const V={class:"incidents"},j={class:"page-header"},B={class:"actions"},O=["disabled"],z={key:0,class:"error-message"},P={class:"incidents-container"},q={class:"card"},G={key:0,class:"loading"},H={key:1,class:"table"},J={class:"actions-group"},K=["onClick"],Q=["onClick"],U=["onClick"],W={key:2,class:"no-data"},X={key:0,class:"incident-details"},Y={class:"detail-row"},Z={class:"detail-row"},ee={class:"detail-row"},te={class:"description"},se={class:"detail-row"},le={class:"detail-row"},ae={class:"detail-row"},ne={key:0,class:"detail-row"},oe={key:1,class:"detail-row"},ie={key:2,class:"detail-row"},re={key:3,class:"detail-row"},de={class:"labels-container"},ue=E({__name:"Incidents",setup(ce){const g=v([]),c=v(!0),b=v(null),s=v(null),h=v(!1),w=async()=>{try{c.value=!0,b.value=null,g.value=await f.getIncidents(),g.value.sort((i,t)=>new Date(t.created_at).getTime()-new Date(i.created_at).getTime())}catch(i){b.value="Error loading incidents",console.error("Error loading incidents:",i)}finally{c.value=!1}},A=()=>{w()},N=i=>{s.value=i,h.value=!0},C=()=>{h.value=!1,s.value=null},m=async i=>{try{await f.acknowledgeIncident(i,{assignee_id:"current_user"}),await w()}catch(t){console.error("Error acknowledging incident:",t),alert("Failed to acknowledge incident")}},I=async i=>{var t;try{await f.resolveIncident(i),await w(),((t=s.value)==null?void 0:t.id)===i&&C()}catch(k){console.error("Error resolving incident:",k),alert("Failed to resolve incident")}};return M(()=>{w()}),(i,t)=>{var k;return o(),n("div",V,[e("div",j,[t[2]||(t[2]=e("h2",null,"Incidents",-1)),e("div",B,[e("button",{onClick:A,class:"btn btn-primary",disabled:c.value},a(c.value?"Loading...":"Refresh"),9,O)])]),b.value?(o(),n("div",z,a(b.value),1)):r("",!0),e("div",P,[e("div",q,[c.value?(o(),n("div",G," Loading incidents... ")):g.value.length>0?(o(),n("table",H,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Title"),e("th",null,"Severity"),e("th",null,"Status"),e("th",null,"Created"),e("th",null,"Duration"),e("th",null,"Actions")])],-1)),e("tbody",null,[(o(!0),n(D,null,$(g.value,l=>(o(),n("tr",{key:l.id},[e("td",null,a(l.id.substring(0,8)),1),e("td",null,a(l.title),1),e("td",null,[e("span",{class:y(`severity-badge severity-${l.severity.toLowerCase()}`)},a(l.severity),3)]),e("td",null,[e("span",{class:y(`status-badge status-${l.status.toLowerCase().replace(" ","-")}`)},a(l.status),3)]),e("td",null,a(_(p)(l.created_at)),1),e("td",null,a(_(T)(l.created_at,l.resolved_at)),1),e("td",null,[e("div",J,[e("button",{class:"btn btn-primary btn-sm",onClick:d=>N(l)}," Details ",8,K),l.status==="open"?(o(),n("button",{key:0,class:"btn btn-warning btn-sm",onClick:d=>m(l.id)}," Acknowledge ",8,Q)):r("",!0),l.status!=="resolved"?(o(),n("button",{key:1,class:"btn btn-success btn-sm",onClick:d=>I(l.id)}," Resolve ",8,U)):r("",!0)])])]))),128))])])):(o(),n("div",W," No incidents found "))])]),S(R,{show:h.value,title:`Incident Details - ${((k=s.value)==null?void 0:k.id.substring(0,8))||""}`,onClose:C},{footer:L(()=>{var l,d;return[((l=s.value)==null?void 0:l.status)==="open"?(o(),n("button",{key:0,class:"btn btn-warning",onClick:t[0]||(t[0]=x=>s.value&&m(s.value.id))}," Acknowledge ")):r("",!0),((d=s.value)==null?void 0:d.status)!=="resolved"?(o(),n("button",{key:1,class:"btn btn-success",onClick:t[1]||(t[1]=x=>s.value&&I(s.value.id))}," Resolve ")):r("",!0),e("button",{class:"btn btn-secondary",onClick:C}," Close ")]}),default:L(()=>[s.value?(o(),n("div",X,[e("div",Y,[t[4]||(t[4]=e("strong",null,"ID:",-1)),u(" "+a(s.value.id),1)]),e("div",Z,[t[5]||(t[5]=e("strong",null,"Title:",-1)),u(" "+a(s.value.title),1)]),e("div",ee,[t[6]||(t[6]=e("strong",null,"Description:",-1)),e("p",te,a(s.value.description||"No description available"),1)]),e("div",se,[t[7]||(t[7]=e("strong",null,"Severity:",-1)),e("span",{class:y(`severity-badge severity-${s.value.severity.toLowerCase()}`)},a(s.value.severity),3)]),e("div",le,[t[8]||(t[8]=e("strong",null,"Status:",-1)),e("span",{class:y(`status-badge status-${s.value.status.toLowerCase().replace(" ","-")}`)},a(s.value.status),3)]),e("div",ae,[t[9]||(t[9]=e("strong",null,"Created:",-1)),u(" "+a(_(p)(s.value.created_at)),1)]),s.value.acknowledged_at?(o(),n("div",ne,[t[10]||(t[10]=e("strong",null,"Acknowledged:",-1)),u(" "+a(_(p)(s.value.acknowledged_at)),1)])):r("",!0),s.value.resolved_at?(o(),n("div",oe,[t[11]||(t[11]=e("strong",null,"Resolved:",-1)),u(" "+a(_(p)(s.value.resolved_at)),1)])):r("",!0),s.value.assignee_id?(o(),n("div",ie,[t[12]||(t[12]=e("strong",null,"Assignee:",-1)),u(" "+a(s.value.assignee_id),1)])):r("",!0),s.value.labels&&Object.keys(s.value.labels).length>0?(o(),n("div",re,[t[13]||(t[13]=e("strong",null,"Labels:",-1)),e("div",de,[(o(!0),n(D,null,$(Object.entries(s.value.labels),([l,d])=>(o(),n("span",{key:l,class:"label-tag"},[e("strong",null,a(l)+":",1),u(" "+a(d),1)]))),128))])])):r("",!0)])):r("",!0)]),_:1},8,["show","title"])])}}}),ge=F(ue,[["__scopeId","data-v-004c3f6b"]]);export{ge as default};
